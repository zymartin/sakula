<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="./index.css">
</head>

<body>
    <div id="root">
        <button id="reset">重置</button>
        <div id="container"></div>
    </div>
    <script>
        var originData =
        {
            key1: {
                name: '肯德基',
                power: 1
            },
            key2: {
                name: '老王牛肉面',
                power: 1
            },
            key3: {
                name: '老上海馄饨',
                power: 1
            },
            key4: {
                name: '永旺',
                power: 1
            },
            key5: {
                name: '兰州拉面',
                power: 1
            },
            key6: {
                name: '萨莉亚',
                power: 1
            },
            key7: {
                name: '大快活',
                power: 1
            },
        };

        Array.prototype.shuffle = function () {
            var array = this;
            var m = array.length,
                t, i;
            while ( m ) {
                i = Math.floor( Math.random() * m-- );
                t = array[m];
                array[m] = array[i];
                array[i] = t;
            }
            return array;
        }
        function parents( elem, selector ) {
            var elements = [];
            var ishaveselector = selector !== undefined;

            while ( ( elem = elem.parentElement ) !== null ) {
                if ( elem.nodeType !== Node.ELEMENT_NODE ) {
                    continue;
                }
                if ( !ishaveselector || elem.matches( selector ) ) {
                    elements.push( elem );
                }
            }

            return elements;
        };

        var root = document.getElementById( 'root' ),
            container = document.getElementById( 'container' ),
            reset = document.getElementById( 'reset' ),
            foodArr = createFoodArr();

        function createFoodArr() {
            var result = [];

            for ( var key in originData ) {
                var item = originData[key];
                for ( var m = 0; m < item.power; m++ ) {
                    result.push( item.name );
                }
            }

            return result;
        }

        function sakulaInit() {
            var chaosArr = foodArr.shuffle();
            var htmlstr = '';
            for ( var i = 0; i < chaosArr.length; i++ ) {
                htmlstr += `<div class="card">
                <div class="card-wrap">
                    <div class="card-front piece">
                        <img src='./sakula-card.jpeg' alt='' />
                    </div>
                    <div class="card-back piece">
                        ${chaosArr[i]}
                    </div>
                </div>
            </div>`
            }
            container.innerHTML = htmlstr;
        }



        sakulaInit();

        container.addEventListener( 'click', function ( e ) {
            parents( e.target, '.card' )[0].classList.toggle( 'back' );
        }, false );

        reset.addEventListener( 'click', function ( e ) {
            sakulaInit();
        } );

    </script>
</body>

</html>